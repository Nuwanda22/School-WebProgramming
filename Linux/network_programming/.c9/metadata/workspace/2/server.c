{"changed":true,"filter":false,"title":"server.c","tooltip":"/2/server.c","value":"\n#include <stdio.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <arpa/inet.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\n#define PORT 7777\t\t// 포트 번호\n#define MAXPENDING 5\t// 클라\n#define BUFSIZE 1024\n\nint main(int argc, char **argv)\n{\n\tint server_sockfd;\t// 서버 소켓 파일 디스크립터\n\tint client_sockfd;\t// 클라 소켓 파일 디스크립터\n\t\n\tstruct sockaddr_in clientaddr;\t// 클라 주소\n\tstruct sockaddr_in serveraddr;\t// 서버 주소\n\t\n\tchar recvBuf[BUFSIZE];\t// 버퍼\n\t\n\tint client_len; // 클라 길이\n\tint recv_len;\n\t\n\tpid_t pid;\n\n\t// 서버 소켓 만들고 저장 오류나면 종료\n\tif((server_sockfd = socket(AF_INET, SOCK_STREAM, 0)) == -1){\n\t\tperror(\"socket error\");\n\t\texit(1);\n\t}\n\t\n\t// serveraddr 초기화\n\tmemset(&serveraddr, 0, sizeof(serveraddr));\n\tserveraddr.sin_family = AF_INET;\n\tserveraddr.sin_addr.s_addr = htonl(INADDR_ANY);\n\tserveraddr.sin_port = htons(atoi(argv[1]));\n\t\n\t// 바인드\n\tif(bind(server_sockfd, (struct sockaddr *)&serveraddr, sizeof(serveraddr)) == -1){\n\t\tperror(\"bind error\");\n\t\texit(1);\n\t}\n\t\n\t// 리슨\n\tif(listen(server_sockfd, MAXPENDING) == -1){\n\t\tperror(\"listen error\");\n\t\texit(1);\n\t}\n\t\n\twhile(1){\n\t\tclient_len = sizeof(clientaddr);\n\t\t// 클라 소켓 받아옴\n\t\tif((client_sockfd = accept(server_sockfd, (struct sockaddr *)&clientaddr, &client_len)) == -1){\n\t\t\tperror(\"accept error\");\n\t\t\texit(1);\n\t\t}\n\t\tprintf(\"\\n  port =  %d  %s\\n\", clientaddr.sin_port, inet_ntoa(clientaddr.sin_addr));\n\t\t\n\t\tif((pid = fork()) == -1){\n\t\t\tperror(\"fork error\");\n\t\t\texit(1);\n\t\t}\n\t\telse if(pid == 0){\n\t\t\tint mypid = getpid();\n\t\t\tclose(server_sockfd);\n\t\t\tprintf(\"mypid[%d] \\n\", mypid);\n\t\t\t\n\t\t\twhile(1){\n\t\t\t\tif((recv_len = recv(client_sockfd, recvBuf, BUFSIZE, 0)) == -1){\n\t\t\t\t\tperror(\"recv error\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(recv_len == 0){\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\trecvBuf[recv_len] = '\\0';\n\t\t\t\tprintf(\"mypid[%d] \\n\", mypid);\n\t\t\t\tprintf(\"Recevied from %d: %s\\n\", client_sockfd, recvBuf);\n\t\t\t\t\n\t\t\t\tif(send(client_sockfd, recvBuf, recv_len, 0) != recv_len){\n\t\t\t\t\tperror(\"send error\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tclose(client_sockfd);\n\t\t\texit(0);\n\t\t}\n\t\tclose(client_sockfd);\n\t}\n\treturn 0;\n}","undoManager":{"mark":-2,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":1048}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":1,"column":0},"end":{"row":1,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1452482451000}